var mmw;(()=>{"use strict";var e={d:(t,o)=>{for(var a in o)e.o(o,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:o[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{_common:()=>he,_comp:()=>we,_control:()=>be,_custom:()=>xe,_event:()=>fe,_layer:()=>Le,_overlay:()=>ve,_router:()=>Se,_view:()=>Ce,map:()=>Te,marker:()=>Ie,markerpopup:()=>Oe,popup:()=>je});var o={};e.r(o),e.d(o,{onCountrySelect:()=>v});var a={};e.r(a),e.d(a,{fetchData:()=>z,fetchJSON:()=>M,goHome:()=>w,loadScript:()=>C,params:()=>b,search:()=>L,setNav:()=>S,setType:()=>x});var r={};e.r(r),e.d(r,{bottombarEl:()=>I,collapse:()=>N,el:()=>O,headerEl:()=>E,loadInset:()=>A,makeCollapsible:()=>j,middleheaderEl:()=>P,rightbarEl:()=>k,rightheaderEl:()=>T});var n={};e.r(n),e.d(n,{initControls:()=>F,initTerrain:()=>R});var i={};e.r(i),e.d(i,{createTab:()=>B,createTablink:()=>J,switchTab:()=>H});var s={};e.r(s),e.d(s,{addFillLayer:()=>G,addLineLayer:()=>W,addSymbolLayer:()=>Z,enablePopup:()=>D,highlightCountries:()=>U});var m={};e.r(m),e.d(m,{moveObject:()=>re,objects:()=>te});var l={};e.r(l),e.d(l,{MAP_BASE:()=>ie,loadMapScript:()=>le,mapId:()=>se,navId:()=>me});var c={};e.r(c),e.d(c,{loadSources:()=>ye});var p=[{id:"sat-layer",type:"raster",source:"sat-tiles"}];let d=new pmtiles.Protocol;maplibregl.addProtocol("pmtiles",d.tile);let u="https://r2-public.protomaps.com/protomaps-sample-datasets/protomaps-basemap-opensource-20230408.pmtiles";const y=new pmtiles.PMTiles(u);d.add(y);const g=protomaps_themes_base.default("protomaps","dark");g.splice(0,12),g.splice(2,1),g.splice(14,1);var f=[...p,...g],h={id:"MMW",version:8,name:"Map My World",center:[0,0],zoom:0,glyphs:"https://cdn.protomaps.com/fonts/pbf/{fontstack}/{range}.pbf",sources:{"raster-tiles":{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,minzoom:2,maxzoom:19,attribution:'Â© Tiles <a href="https://openstreetmap.org">OpenStreetMap</a>'},"sat-tiles":{type:"raster",tiles:["https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],tileSize:256,minzoom:2,maxzoom:19,attribution:'<a href="https://www.arcgis.com/index.html">Esri ArcGIS</a>'},protomaps:{type:"vector",url:"pmtiles://"+u,minzoom:2,maxzoom:19,attribution:'Powered by <a href="https://protomaps.com">Protomaps</a>'},terrainSource:{type:"raster-dem",tiles:['https://api.ellipsis-drive.com/v3/path/085f5e10-63b6-4e8f-a4c6-dce9689100d3/raster/timestamp/3179fa80-60ad-41c7-ae67-cdd5eeeca693/tile/{z}/{x}/{y}?style={"method":"terrainRgb", "parameters":{"alpha":1, "bandNumber":1} }'],tileSize:256}}};function v(e,t){function o(o){const a=map.queryRenderedFeatures(o.point),r=a[a.length-1];if(e&&r){var n=turf.center(r);map.flyTo({center:n.geometry.coordinates})}t(o,r)}mmw.map.on("click",o),mmw.map.on("touchstart","countries",o)}document.addEventListener("keydown",(function(e){!e.ctrlKey||38!=e.keyCode&&40!=e.keyCode?setTimeout((function(){e.stopPropagation(),mmw.map.handlers.handleEvent(e)})):function(e){let t=mmw.map.getZoom();if(-1==e&&t<1)return;let o=.25*e;mmw.map.zoomTo(t+o)}(38==e.keyCode?-1:1)}));const b=new URLSearchParams(document.location.search);function w(){window.location.href=window.location.origin+window.location.pathname}function L(e,t){b.set(e,t),window.location.search="?"+b.toString()}function S(e){L("nav",e)}function x(e){L("type",e)}function C(e){var t=document.createElement("script");t.src=e,document.body.append(t)}async function z(e){let t=await fetch(e);return await t.text()}async function M(e){var t=await z(e);return JSON.parse(t)}var _,E=O("header"),P=O("middleheader"),T=O("rightheader"),k=O("rightbar"),I=O("bottombar");function O(e){return document.getElementById(e)}function j(e){e.addEventListener("click",(function(){this.classList.toggle("active");var e=this.nextElementSibling;"none"===e.style.display?e.style.display="block":e.style.display="none"}))}function N(e){e.classList.toggle("active"),e.nextElementSibling.style.display="none"}function A(e){return _||((_=document.createElement("iframe")).classList="top right mmw-overlay mmw-overlay-group inset",document.body.append(_)),_.src=e,_}function F(){mmw.map.addControl(new maplibregl.NavigationControl({showCompass:!1}),"bottom-left"),mmw.map.addControl(new maplibregl.NavigationControl({visualizePitch:!0,showZoom:!1}),"bottom-left"),mmw.map.addControl(new maplibregl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),"bottom-left")}function R(){mmw.map.addControl(new maplibregl.TerrainControl({source:"terrainSource",exaggeration:1}),"top-left")}function B(){var e=document.createElement("div");return e.classList.add("tab"),e.setAttribute("onclick","mmw._comp.switchTab(this)"),e}function H(e,t){for(var o=e.children,a=0;a<o.length;a++)o[a].classList.remove("active");(null==t?event.target:o[t]).classList.add("active")}function J(e){var t=document.createElement("span");return t.classList.add("tablink"),t.innerHTML=e,t}function Z(e,t,o,a){var r=newSymbolLayer(e,t,o);mmw.map.addLayer(r),a&&D(e,a)}function D(e,t){var o=e+"-symbols";mmw.map.on("mouseenter",o,(e=>{mmw.map.getCanvas().style.cursor="pointer";const o=t(e);if(o){const t=e.features[0].geometry.coordinates.slice();for(;Math.abs(e.lngLat.lng-t[0])>180;)t[0]+=e.lngLat.lng>t[0]?360:-360;mmw.popup.setLngLat(t).setHTML(o).addTo(map)}})),mmw.map.on("mouseleave",o,(()=>{mmw.map.getCanvas().style.cursor="",mmw.popup.remove()}))}function G(e,t,o,a){var r,n=e+"-fills",i=newFillLayer(e,t,o,a);a&&(mmw.map.on("mousemove",n,(t=>{t.features.length>0&&(r&&mmw.map.setFeatureState({source:e,id:r},{hover:!1}),r=t.features[0].id,mmw.map.setFeatureState({source:e,id:r},{hover:!0}))})),mmw.map.on("mouseleave",n,(()=>{r&&mmw.map.setFeatureState({source:e,id:r},{hover:!1})}))),mmw.map.addLayer(i)}function W(e,t,o){var a=newLineLayer(e,t,o);mmw.map.addLayer(a)}function U(e){e.length>1?map.setFilter("countries-boundary",["any",["==","NAME",e[0]],["==","NAME",e[1]]]):map.setFilter("countries-boundary",["==","NAME",e[0]])}var q,K,X,Y,Q,V,$,ee,te={},oe=1,ae=50;function re(){if(routes&&-1!=X){null==X&&(X=routes.length-1,Y=0),K=routes[X];var e=te[K.properties.object];if(e&&(q!=e&&(q?scene3js.remove(q.scene):$||ne(),q=e,K.properties.direction&&(q.scene.rotation.y=K.properties.direction*Math.PI/180),map.flyTo({center:geoJSONData[2].features[X].geometry.coordinates,zoom:K.properties.zoom||zoom,pitch}),scene3js.add(q.scene)),X>=0))if(oe<ae)def_transform.translateX=$.x,def_transform.translateY=$.y,$.x=$.x+ee.x,$.y=$.y+ee.y,oe+=1;else{if(oe=1,(Y+=1)==K.geometry.coordinates.length-1){if(-1==(X-=1))return;K=routes[X],Y=0,map.flyTo({center:geoJSONData[2].features[X].geometry.coordinates,zoom,pitch})}ne()}}}function ne(){Q=maplibregl.MercatorCoordinate.fromLngLat(K.geometry.coordinates[Y],0),V=maplibregl.MercatorCoordinate.fromLngLat(K.geometry.coordinates[Y+1],0),$=Q,ae=K.properties.steps||50,ee={x:(V.x-Q.x)/ae,y:(V.y-Q.y)/ae}}var ie="/maps/",se=b.get("id"),me=b.get("nav");function le(e){C(ie+e+"/"+e+".js")}se&&le(se);let ce=b.get("src"),pe=b.get("view"),de=b.get("type"),ue="pin";function ye(){ce&&("inset"!=pe?("basic"==de?mmw.map.setZoom(16.5):mmw.map.setZoom(15.99),mmw.map.setPitch(60)):ue="pin-xs",mmw.map.loaded()?ge(ce):mmw.map.on("load",(function(){ge(ce)})))}async function ge(e){var t,o;e=e.split(",");for(let o=0;o<e.length;o++){var a=e[o];if(a){var r=await M(a);(t=r.features[0])&&(mmw.map.addSource("source-"+o,{type:"geojson",data:r}),t.properties.height?mmw.map.addLayer(newExtrusionLayer("source-"+o)):(G("source-"+o,"",.5,.2),W("source-"+o,"",2)),Z("source-"+o,ue,["get","name"]))}}"Polygon"==t.geometry.type&&(o=t.geometry.coordinates[0][0],mmw.map.flyTo({center:o}))}const fe=o,he=a,ve=r,be=n,we=i,Le=s,Se=m,xe=l,Ce=c;let ze=b.get("z")||3.5,Me=b.get("lat")||22,_e=b.get("lng")||80,Ee=b.get("type");var Pe=h;"basic"===Ee?h.layers=[{id:"basic-layer",type:"raster",source:"raster-tiles"}]:"satellite"===Ee?h.layers=p:"hybrid"===Ee?h.layers=f:"none"===Ee?h.layers=[]:"demo"==Ee?Pe="https://demotiles.maplibre.org/style.json":x("basic");const Te=new maplibregl.Map({container:"map",hash:!0,style:Pe,center:[_e,Me],zoom:ze,pitch:0,bearing:0,antialias:!0,maxPitch:85}),ke=Te._controls[0];Te.removeControl(ke),Te.addControl(ke,"bottom-left"),Te.on("load",(()=>{ke._compact=!0,ke._updateCompact(),ke._updateCompactMinimize()})),Te.loadImage("img/pin-sm.png",((e,t)=>{Te.addImage("pin",t),Te.addImage("pin-xs",t,{pixelRatio:2})})),Te.loadImage("img/pin-blue-sm.png",((e,t)=>{Te.addImage("pin-blue",t),Te.addImage("pin-blue-xs",t,{pixelRatio:2})}));const Ie=new maplibregl.Marker,Oe=new maplibregl.Popup({closeButton:!1});Ie.setPopup(Oe);const je=new maplibregl.Popup({closeButton:!1,closeOnClick:!1});mmw=t})();